# Noyola Hub - Development Rules for Cursor

This is an educational game ecosystem for Emma (10, 5th grade) and Liam (8, 3rd grade). Games are deployed to Vercel as static sites with localStorage + Supabase cloud sync.

## Development Environment (Windows)

**IMPORTANT:** To use git in shell commands, first add it to PATH:
```powershell
$env:Path += ";C:\Program Files\Git\cmd"
```

Then git commands will work normally: `git status`, `git add .`, `git commit -m "message"`, `git push origin main`

## Project Context

- **Live URL:** https://kid-games-one.vercel.app/
- **Core Module:** `shared/lumina-core.js` - Handles profiles, XP, coins, achievements, streaks
- **Cloud Sync:** `shared/lumina-cloud.js` + `shared/supabase-config.js` - Supabase integration
- **Target Devices:** iPad Safari (primary), desktop browsers
- **Design Philosophy:** Learning disguised as gameplay, real rewards for real effort

## AI Asset Generation Tools

Use the tools in `/tools/` to generate game assets automatically. API keys are loaded from `.env` file.

### Images (sprites, backgrounds, UI)
```bash
python tools/generate_image.py --prompt "DESCRIPTION" --type sprite|background|ui --style STYLE --output assets/PATH
```
- **Styles:** `pixel-art`, `8-bit`, `16-bit`, `painterly`, `cartoon`, `flat`, `anime`
- **Style Selection (IMPORTANT):** Choose style based on the game description and the `MASTER_IMAGE_GENERATION_GUIDE.md`.
  - If a game has a dedicated prompt doc (e.g., `spell-siege/IMAGE_GENERATION_PROMPTS.md`), follow its specified style and palette.
  - If no prompt doc exists, infer the best fit from `GAME_DESCRIPTIONS.md` and document the chosen style in the prompt.
- Add `--quality` flag for images with text (titles, UI labels)
- Uses Google Gemini API

### Sound Effects (ElevenLabs)
```bash
python tools/generate_sfx.py --prompt "DESCRIPTION" --duration SECONDS --output assets/audio/GAME_ID/sfx/FILE.mp3
```
- Duration: 0.5-22 seconds (omit for auto)
- Great for: UI clicks, correct/wrong sounds, coin collect, level up

### Voice Lines (Cartesia)
```bash
python tools/generate_voice.py --text "TEXT" --voice VOICE_PRESET --output assets/audio/GAME_ID/voice/FILE.mp3
```
- **Voice Presets:** `cheerful_female`, `calm_male`, `excited_child`
- Great for: Feedback ("Great job!"), narration, character dialogue

### Music Generation

**RECOMMENDED: Google Vertex AI Lyria 2 (High Quality)**
```bash
python tools/generate_music_vertex.py --prompt "DESCRIPTION" --output assets/audio/GAME_ID/music/FILE.wav
```
- Duration: ~30 seconds per clip (fixed)
- Format: 48kHz stereo WAV (high quality)
- Cost: ~$0.06 per clip
- **Always include "instrumental" in prompts** for game music (no vocals)
- Supports negative prompting with `--negative "EXCLUDE_DESCRIPTION"`
- Reproducible output with `--seed NUMBER`
- Generate multiple variations with `--samples N`

**Alternative: ElevenLabs API (Short Clips)**
```bash
python tools/generate_music.py --prompt "DESCRIPTION" --duration SECONDS --output assets/audio/GAME_ID/music/FILE.mp3
```
- Duration: 0.5-22 seconds (ElevenLabs limit, default: 20s)
- Format: MP3
- Use for very short clips (UI sounds, short jingles)

**Example prompts (work for both):**
- `"educational game menu music, welcoming, magical, loopable, instrumental"`
- `"adventure gameplay music, focused but fun, not distracting, instrumental"`
- `"victory fanfare, achievement unlocked, triumphant, instrumental"`
- `"boss battle music, intense but kid-friendly, orchestral, instrumental"`

**For longer music loops:**
1. Generate multiple 30-second clips with Lyria 2
2. Use audio editing software to create seamless loops
3. Or loop individual clips in-game

### Asset Output Paths
```
assets/
‚îú‚îÄ‚îÄ audio/
‚îÇ   ‚îî‚îÄ‚îÄ [game-id]/
‚îÇ       ‚îú‚îÄ‚îÄ music/     # .wav files (Lyria 2) or .mp3 files (ElevenLabs)
‚îÇ       ‚îú‚îÄ‚îÄ sfx/       # .mp3 files (ElevenLabs API)
‚îÇ       ‚îî‚îÄ‚îÄ voice/     # .mp3 files (Cartesia API)
‚îú‚îÄ‚îÄ sprites/
‚îÇ   ‚îî‚îÄ‚îÄ [game-id]/     # Character sprites, items, enemies (Gemini + rembg)
‚îÇ       ‚îú‚îÄ‚îÄ sprite.png        # Original with background
‚îÇ       ‚îî‚îÄ‚îÄ sprite_rgba.png   # Transparent version (use this in games)
‚îú‚îÄ‚îÄ backgrounds/
‚îÇ   ‚îî‚îÄ‚îÄ [game-id]/     # Level backgrounds, menus (Gemini)
‚îî‚îÄ‚îÄ [game-id]/         # Game-specific images if needed
```

### Transparent Background Workflow (CRITICAL)
For sprites that need transparency (characters, items, enemies):

1. **Generate with solid background:**
   ```bash
   python tools/generate_image.py -p "description" -t sprite -s STYLE -o assets/sprites/[game-id]/sprite.png
   ```

2. **Remove background using rembg:**
   ```bash
   py -3.13 tools/remove_bg.py --input assets/sprites/[game-id]/sprite.png --output assets/sprites/[game-id]/sprite_rgba.png
   ```

3. **Use `*_rgba.png` in game code:**
   ```javascript
   <img src="../assets/sprites/[game-id]/sprite_rgba.png" alt="Sprite" />
   ```

**IMPORTANT:** Always generate sprites with `generate_image.py`, then process with `remove_bg.py` to create true RGBA transparent PNGs. Never use emoji placeholders for final game assets.

## Game Architecture Pattern

All games follow this modular structure:

```
[game-folder]/
‚îú‚îÄ‚îÄ index.html              # Entry point (~100 lines, clean HTML)
‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îî‚îÄ‚îÄ game-base.css       # Styles & animations
‚îî‚îÄ‚îÄ scripts/
    ‚îú‚îÄ‚îÄ game-config.js      # Constants, word lists, settings
    ‚îú‚îÄ‚îÄ game-audio.js       # AudioManager class (if needed)
    ‚îú‚îÄ‚îÄ game-components.js  # React sub-components (if needed)
    ‚îú‚îÄ‚îÄ game-main.js        # Main React component
    ‚îî‚îÄ‚îÄ game-init.js        # ReactDOM.render call (2-4 lines)
```

### Script Loading Order (in index.html)
```html
<!-- Before </body> -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="../shared/lumina-core.js"></script>  <!-- MUST load before game scripts -->
<script type="text/babel" src="scripts/game-config.js"></script>
<script type="text/babel" src="scripts/game-main.js"></script>
<script type="text/babel" src="scripts/game-init.js"></script>
```

**IMPORTANT:** When building games, always reference `GAME_DESIGN_STANDARDS.md` for juice implementation, progression systems, and polish requirements.

## LuminaCore Integration (REQUIRED for all games)

### 1. Get Active Profile on Mount
```javascript
const [playerProfile, setPlayerProfile] = React.useState(null);

React.useEffect(() => {
  const profile = LuminaCore.getActiveProfile();
  if (profile) {
    setPlayerProfile(profile);
    LuminaCore.recordGameStart(profile.id, 'game-id');
  }
}, []);
```

### 2. Award XP and Coins During Gameplay
```javascript
// XP: 10-50 per correct answer, scale by difficulty
// Coins: 1-5 per correct answer
// Reward Points: ~10% of XP earned

if (playerProfile) {
  LuminaCore.addXP(playerProfile.id, xpEarned, 'game-id');
  LuminaCore.addCoins(playerProfile.id, coinsEarned, 'game-id');
  LuminaCore.addRewardPoints(playerProfile.id, Math.floor(xpEarned * 0.1));
}
```

### 3. Record Session on Game End
```javascript
if (playerProfile) {
  LuminaCore.recordGameEnd(playerProfile.id, 'game-id', {
    score: totalScore,
    gamesWon: won ? 1 : 0,
    // Custom stats for this game
  });
}
```

### 4. Check Achievements
```javascript
LuminaCore.checkAchievement(playerProfile.id, 'first_win');
LuminaCore.checkAchievement(playerProfile.id, 'score_1000');
```

### 5. Return to Hub Button (always include)
```javascript
{playerProfile && (
  <a href="../index.html" className="hub-return-link">
    üè† Return to Noyola Hub
  </a>
)}
```

## Adding a New Game to the Hub

### Step 1: Create Game Folder
```bash
mkdir [game-id]
mkdir [game-id]/styles
mkdir [game-id]/scripts
mkdir assets/audio/[game-id]/music
mkdir assets/audio/[game-id]/sfx
```

### Step 2: Register in hub-config.js
```javascript
// In shared/scripts/hub-config.js, add to GAMES array:
{
  id: 'game-id',
  title: 'Game Title',
  description: 'Brief description',
  icon: 'üéÆ',
  color: 'from-purple-500 to-pink-500',
  path: './game-id/index.html',
  subjects: ['math', 'spelling'],
  status: 'active'
}
```

### Step 3: Generate Assets
```bash
# Images and SFX (automated)
python tools/generate_image.py -p "player character" -t sprite -s STYLE -o assets/sprites/player.png
python tools/generate_sfx.py -p "correct answer chime" -d 0.5 -o assets/audio/game-id/sfx/correct.mp3

# Music (manual) - use Lyria 2 or Suno Pro, save to:
# assets/audio/game-id/music/menu.wav
# assets/audio/game-id/music/gameplay.wav
# assets/audio/game-id/music/victory.wav
```

## Code Style Guidelines

### React Components
- Use functional components with hooks
- Keep main component in `game-main.js`
- Extract reusable UI to `game-components.js`
- Use Tailwind CSS classes for styling

### State Management
- Game state in React useState
- Player progress via LuminaCore (not local state)
- Audio state in AudioManager class

## Visual Design System

### Colors (CSS Variables in hub-themes.css)
```css
--primary: #667eea ‚Üí #764ba2 (purple gradient)
--accent: #fbbf24, #f59e0b (gold/amber)
--background: #1a1a2e, #16213e (dark purple)
```

### Fonts
- Display: Fredoka (game titles, headers)
- Body: Quicksand (readable text)

### Responsive
- Mobile-first, iPad optimized
- Test at 768px and 1024px breakpoints

## Deployment

Changes auto-deploy via GitHub ‚Üí Vercel:
```bash
git add .
git commit -m "Description of changes"
git push origin main
```

Live at: https://kid-games-one.vercel.app/

## Target Audience Reminders

- **Emma (10, 5th grade):** Strategic thinker, likes planning and puzzles
- **Liam (8, 3rd grade):** Action-oriented, likes fast-paced gameplay
- Content should be educational but feel like real games
- Difficulty should scale appropriately for both age groups
- Keep UI simple enough for 8-year-old, engaging enough for 10-year-old
